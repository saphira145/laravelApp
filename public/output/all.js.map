{"version":3,"sources":["js.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["\r\n'use strict';\r\n\r\n// Search ajax\r\nvar search = (function(){       \r\n\r\n    // Varriables\r\n    var $list_student = $(\".list-student\");\r\n    var $search_button = $(\"#search_button\");\r\n    var $search_key = $(\"#search_key\");\r\n    var $ajax_loading = $(\".ajax-loading\");\r\n    var url;\r\n    var search_key;\r\n\r\n    // Bind Events\r\n    $search_button.on('click', searchAjax);\r\n    $search_key.keypress(enterPress);\r\n\r\n    function cacheValue() {\r\n        search_key = $search_key.val();\r\n        url = 'students/searchAndPaginateAjax?search_key=' + search_key;\r\n    }\r\n\r\n    function searchAjax() {\r\n        cacheValue();\r\n        $.ajax({\r\n            url : url,\r\n            type : 'get',\r\n            dataType: 'html',\r\n            beforeSend : function() {\r\n                $ajax_loading.show();\r\n            },\r\n            error : function() {\r\n                //\r\n            },\r\n            success : function(response) {\r\n                $list_student.html(response);\r\n            }\r\n        });\r\n    }\r\n    function enterPress(e) {\r\n        if (e.which === 13) {\r\n            $search_button.click();\r\n        }\r\n    }\r\n\r\n    function getSearchKey() {\r\n        return search_key;\r\n    }\r\n\r\n    return {\r\n        getSearchKey : getSearchKey\r\n    };\r\n\r\n})();\r\n\r\n// Pagination ajax\r\nvar pagination = (function(){\r\n    \r\n    // Varriables\r\n    var $list_student = $(\".list-student\");\r\n    var url;\r\n    var search_key;\r\n    var pageIndex;     \r\n    \r\n    // Bind Events\r\n    $list_student.on('click', '.pagination > li', paginateAjax.bind(this));\r\n    \r\n    function cacheValue(event) {\r\n        pageIndex = $(event.target).attr(\"href\").split(\"page=\")[1];\r\n        url = 'students/searchAndPaginateAjax?page=' + pageIndex;\r\n        search_key = search.getSearchKey(); \r\n        if(search_key !== undefined) \r\n            url += '&search_key=' + search_key;\r\n    }\r\n    \r\n    function paginateAjax(event) {\r\n        event.preventDefault();\r\n        cacheValue(event);\r\n        $.ajax({\r\n            url : url,\r\n            type : 'get',\r\n            dataType: 'html',\r\n            error : function() {\r\n                //\r\n            },\r\n            beforeSend : function(xhr) {\r\n                (pageIndex === undefined) ? xhr.abort() : $(\".ajax-loading\").show();\r\n            },\r\n            success : function(response) {\r\n                $list_student.html(response);\r\n            }\r\n        });\r\n    }\r\n})();\r\n    \r\n\r\n// sticky search\r\n$(\".search-box\").sticky({ topSpacing: 0 });\r\n//slide up message\r\n$(\".alert-success\").delay(3000).slideUp();\r\n//confirm delete button\r\n$(\".btn-delete\").on('click', function() {\r\n    if (!confirm(\"Bạn có muốn xóa?\"))\r\n        return false;\r\n});\r\n// validate form student\r\n$(\"#create-student-form\").validate({\r\n    messages : {\r\n        student_code : \"Nhập mã sinh viên\",\r\n        fullname : \"Nhập tên sinh viên\",\r\n        birthday : \"Nhập ngày sinh\",\r\n        address : \"Nhập địa chỉ\"\r\n    }\r\n});\r\n\r\n\r\nvar StudentManagement = (function() {\r\n    // variable\r\n    var $filter = $(\".sex-filter\");\r\n    var $checkbox = $filter.find(\"li\");\r\n    var $body = $('body');\r\n    var $editStudentForm = $('#edit-student-form');\r\n    var $close = $('#close-student-modal');\r\n    var id; // Current Student ID\r\n    var methodRequest; // Method request: PUT for update,  POST for new\r\n\r\n    // Bind event\r\n    $checkbox.on('click', filter);\r\n    $body.on('click', '.delete-student', deleteStudent);\r\n    $body.on('click', '.edit-student', editStudent);\r\n    $body.on('click', '#save-student', saveStudent);\r\n    $body.on('click', '#create-student', createStudent);\r\n\r\n    function filter(event) {\r\n        if (event.target.tagName === 'LABEL') {\r\n            return;\r\n        }\r\n        dataTable.ajax.reload();\r\n    }\r\n    function getCheckbox() {\r\n        return $checkbox;\r\n    }\r\n    function createStudent() {\r\n        var createUrl = '/students/create';\r\n        $.ajax({\r\n            url : createUrl,\r\n            type : 'GET',\r\n            success : function(response) {\r\n                $editStudentForm.html(response);\r\n                methodRequest = 'POST';\r\n            }\r\n        });\r\n    }\r\n\r\n    function deleteStudent(event) {\r\n        event.preventDefault();\r\n        if (!confirm('Are you sure you want to delete'))\r\n            return;\r\n\r\n        var deleteUrl = $(\".delete-student\").attr(\"data\");\r\n        $.ajax({\r\n            'url' : deleteUrl,\r\n            'type' : 'DELETE',\r\n            'headers' : {\r\n                'X-CSRF-Token' : $('#_token').val(),\r\n            },\r\n            success : function() {\r\n                dataTable.ajax.reload(null, false);\r\n            }\r\n        });\r\n    };\r\n\r\n    function editStudent(event) {\r\n        event.preventDefault();\r\n        id = $(event.target).attr(\"data\");\r\n        var editUrl = \"/students/\"+ id +\"/edit\";\r\n\r\n        $.ajax({\r\n            url : editUrl,\r\n            type : 'GET',\r\n            success : function(response) {\r\n                $editStudentForm.html(response);\r\n                methodRequest = \"PUT\";\r\n            }\r\n        });\r\n    } \r\n\r\n    function saveStudent() {\r\n        var data = $editStudentForm.serialize();\r\n        var saveUrl;\r\n        if (methodRequest === 'PUT')\r\n            saveUrl = '/students/'+ id;\r\n        if (methodRequest === 'POST')\r\n            saveUrl = '/students';\r\n        $.ajax({\r\n            url : saveUrl,\r\n            type : 'PUT',\r\n            data : data,\r\n            headers : {\r\n                'X-CSRF-Token' : $('#_token').val()\r\n            },\r\n            beforeSend : function() {\r\n                this.type = methodRequest;\r\n            },\r\n            success : function(response) {\r\n                switch(response.status) {\r\n                    case 0:\r\n                        $editStudentForm.html(response.html);\r\n                        break;\r\n                    case 1:\r\n                    default:\r\n                        dataTable.ajax.reload(null, false);\r\n                        $close.trigger('click');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    return {\r\n        getCheckbox : getCheckbox\r\n    };\r\n\r\n})();\r\n//\r\nvar dataTable = $('#mytable').DataTable({\r\n    processing : true,\r\n    serverSide : true,\r\n    ajax : {\r\n        url : '/students/ajax',\r\n        type : 'post',\r\n        headers : {\r\n            'X-CSRF-Token' : $('#_token').val()\r\n        },\r\n        data : function(param) {\r\n            var filter = [];\r\n            var $checkbox = StudentManagement.getCheckbox();\r\n            $checkbox.each(function(){\r\n                if ($(this).find('input').prop(\"checked\")) {\r\n                    filter.push($(this).find('input').val());\r\n                }\r\n            });\r\n            param.filter = filter;\r\n        }\r\n    },\r\n    columnDefs: [{\r\n        targets: -1,\r\n        data: null,\r\n        render: function(data) {\r\n            var template = \"<a href='#' data='\"+ data +\"' class='edit-student' data-toggle='modal' data-target='#myModal'>Edit |</a>\"\r\n                         + \"<a href='#' data='\"+ data +\"' class='delete-student'> Delete</a>\";\r\n\r\n            return template;\r\n        }\r\n    }],\r\n    columns : [\r\n        {'data' : 'student_code'},\r\n        {'data' : 'fullname'},\r\n        {'data' : 'birthday'},\r\n        {'data' : 'sex'},\r\n        {'data' : 'address'},\r\n        {'data' : 'id'}\r\n    ],\r\n//        language : {\r\n//            search : '132323'\r\n//        }\r\n});\r\n    \r\nvar nameManager = (function() {\r\n    var $addName = $(\".add-name\");\r\n    var $nameInput = $addName.find(\"input\");\r\n    var url = '/students/getName';\r\n    var $body = $(\"body\");    \r\n    var data;\r\n    \r\n    // Bind Events\r\n    $body.on('click', '.save-name', saveName);\r\n    $body.on('click','.delete-name', deleteName);\r\n    $body.on('click', '.edit-name', editName);\r\n    $body.on('keyup', '.search-name', searchName);\r\n    \r\n    $.ajax({\r\n        type : 'GET',\r\n        url : url,\r\n        success : function(response) {\r\n            data = response;\r\n            renderList(data);\r\n            \r\n        }\r\n    });\r\n    function renderList(data) {\r\n        for(var length=data.length, i=length-1; i>= 0; i--) {\r\n            var element = render(data[i]);\r\n            $addName.after(element);\r\n        }\r\n    }\r\n    function searchName(event) {\r\n        var $labelManager = $('.label-manager');\r\n        var searchKey = $(event.target).val();\r\n        var result = processSearchData(searchKey, data);\r\n        $labelManager.remove();\r\n        renderList(result);\r\n    }\r\n    function processSearchData(searchKey, data) {\r\n        var result = [];\r\n        for(var i=0, length=data.length; i<length; i++) {\r\n            if (data[i].fullname.toLowerCase().indexOf(searchKey.toLowerCase()) > -1) {\r\n                result.push(data[i]);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    function editName(event) {\r\n        event.preventDefault();\r\n        var $element = $(event.target).parent().parent();\r\n        var $nameLabel = $element.find('span');\r\n        var $editInput = $element.find('input');\r\n        var $cancel = $element.find('.cancel-name');\r\n        \r\n        // Change background input when on edit mode\r\n        $element.toggleClass(\"focus-edit\");\r\n        $nameLabel.toggleClass('hide');\r\n        $cancel.toggleClass('hide');\r\n        $editInput.toggleClass('hide').focus();\r\n\r\n        var id = $(event.target).parent('a').attr('id'); \r\n        \r\n        if (!$element.find(\"input\").hasClass(\"hide\")) {\r\n            $editInput.val($nameLabel.text());\r\n        }\r\n\r\n        if($element.find(\"input\").hasClass(\"hide\")) {\r\n            var url = \"/students/editName\";\r\n            var fullname = $editInput.val();\r\n            \r\n            $.ajax({\r\n                url : url,\r\n                type : 'PUT',\r\n                headers : {\r\n                    'X-CSRF-Token' : $('#_token').val()\r\n                },\r\n                data : {\r\n                    id : id,\r\n                    fullname : fullname\r\n                },\r\n                success : function(response) {\r\n                    if (response.status === 1) {\r\n                        $nameLabel.text(response.fullname);\r\n                        refreshData(id, fullname, 'edit');\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        \r\n    }\r\n    function deleteName(event) {\r\n        event.preventDefault();\r\n        var url = '/students/deleteName';\r\n        var id = $(event.target).parent('a').attr('id');\r\n        $.ajax({\r\n            url : url,\r\n            type : 'DELETE',\r\n            data : {\r\n                id : id\r\n            },\r\n            headers : {\r\n                'X-CSRF-Token' : $('#_token').val()\r\n            }, \r\n            success : function(response) {\r\n                if (response.status === 1) {\r\n                    $(event.target).parent().parent().remove();\r\n                    $(event.target).parent('.label-manager').remove();\r\n                    refreshData(id, null, 'delete');\r\n                }\r\n            }\r\n        });\r\n    }\r\n    function saveName() {\r\n       var fullname = $nameInput.val();\r\n       var url = '/students/saveName';\r\n       $.ajax({\r\n            url : url,\r\n            type : 'POST',\r\n            data : {\r\n                fullname : fullname\r\n            },\r\n            headers : {\r\n                'X-CSRF-Token' : $('#_token').val()\r\n            },\r\n           success: function(response) {\r\n                if (response.status === 1) {\r\n                    var element = render(response.data);\r\n                    $addName.after(element);\r\n                    refreshData(response.data.id, response.data.fullname, 'create');\r\n                }\r\n           }\r\n       });\r\n    }\r\n    \r\n    function refreshData(id, fullname, action) {\r\n        switch(action) {\r\n            case 'edit' :\r\n                for(var i=0, length=data.length; i<length; i++) {\r\n                    if (data[i].id == id) {\r\n                        data[i].fullname = fullname;\r\n                    }\r\n                }\r\n                break;\r\n            case 'delete' :\r\n                for(var i=0, length=data.length; i<length; i++) {\r\n                    if (data[i].id == id) {\r\n                        data.splice(i, 1);\r\n                    }\r\n                }\r\n                break;\r\n            case 'create' :\r\n            default :\r\n                data.unshift({id : id, fullname : fullname});\r\n                \r\n        }\r\n    }\r\n    function render(data) {\r\n        var template = '<label class=\"xs-col-12 label-manager\">'\r\n                        + '<input type=\"text\" id=\"editInput\" class=\"hide\" placeholder=\"Type new name\">'\r\n                        + '<span>'+ data.fullname +'</span>'\r\n                        + '<a href=\"#\" class=\"pull-right delete-name\" id='+ data.id +'><i class=\"fa fa-trash-o\"></i></a>'\r\n                        + '<a href=\"#\" class=\"pull-right cancel-name hide\"><i class=\"fa fa-ban\"></i></a>'\r\n                        + '<a href=\"#\" class=\"pull-right edit-name\" id='+ data.id +'><i class=\"fa fa-pencil-square-o\"></i></a>'\r\n                     + '</label>';\r\n        return template;              \r\n    }\r\n})();\r\n    \r\n"],"sourceRoot":"/source/"}